# Goフレームワーク改善指示プロンプト

## 指示内容
以下の在庫管理フレームワークに対して、指定された改善項目を実装してください。

## 現在のコード構造
```
pkg/inventory/
├── errors.go          # エラー定義とカスタムエラー型
├── interface.go       # 主要インターフェース定義
├── manager.go         # メイン在庫管理ロジック
├── manager_test.go    # ユニットテスト
├── storage/
│   └── postgres.go    # PostgreSQL実装
├── tracking.go        # ロット・追跡管理
├── types.go          # 型定義とヘルパーメソッド
└── valuation.go      # 在庫評価・分析エンジン
```

## 改善指示：[改善項目名]

### 対象ファイル
- [修正対象のファイルパスを記載]

### 実装要件
[具体的な実装要件を記載]

### 実装ガイドライン
1. **コーディング規約遵守**
   - Go標準のコーディングスタイルに従う
   - 日本語コメントと英語コメントを併用
   - エラーハンドリングは構造化エラーを使用
   - ログ出力にはzap.Loggerを使用

2. **設計原則**
   - 既存のインターフェース設計を維持
   - SOLID原則に従った実装
   - シンプルで理解しやすい実装を心がける
   - オーバーエンジニアリングを避ける

3. **エラーハンドリング**
   ```go
   // 推奨エラーハンドリングパターン
   if err != nil {
       return NewStorageError("operation_name", "説明メッセージ", err)
   }
   ```

4. **ログ出力**
   ```go
   // 推奨ログパターン
   m.logger.Info("操作完了",
       zap.String("operation", "add"),
       zap.String("item_id", itemID),
       zap.Int64("quantity", quantity),
   )
   ```

5. **テスト**
   - 新機能には対応するテストケースを追加
   - モックを使用したユニットテスト
   - エラーケースのテストも含める

### 実装制約
- Go 1.21の機能を適切に活用
- 既存のコードとの互換性を維持
- パフォーマンスを考慮した実装
- メモリリークやゴルーチンリークを避ける
- PostgreSQLのトランザクション機能を適切に利用

### 実装後の確認項目
- [ ] コンパイルエラーがないこと
- [ ] 既存テストがすべてパスすること
- [ ] 新機能のテストケースが追加されていること
- [ ] 適切なエラーハンドリングが実装されていること
- [ ] ログ出力が適切に行われていること
- [ ] ドキュメントコメントが適切に記載されていること

### 出力形式
以下の形式で実装結果を出力してください：

````markdown
# 改善実装結果

## 実装概要
[実装した内容の概要]

## 変更ファイル

### [ファイル名]
```go
[実装コード]
```

### [ファイル名]（新規作成）
```go
[実装コード]
```

## テストコード

### [テストファイル名]
```go
[テストコード]
```

## 実装のポイント
- [実装時に考慮した点]
- [パフォーマンス最適化の内容]
- [エラーハンドリングの工夫]

## 使用例
```go
[新機能の使用例コード]
```

## 注意事項
- [運用時の注意点]
- [設定が必要な項目]
- [依存関係の変更]
````

### 実装品質基準
- **可読性**: コードが理解しやすく、適切にコメントされている
- **保守性**: 将来的な変更に対応しやすい構造
- **テスタビリティ**: テストが書きやすく、モックしやすい設計
- **パフォーマンス**: 不要な処理やメモリ使用を避けている
- **エラー処理**: 適切なエラー情報とスタックトレースを提供

この指示に従って、指定された改善項目を実装してください。実装時に不明な点や設計判断に迷う点があれば、既存コードのパターンに従うか、よりシンプルな実装を選択してください。